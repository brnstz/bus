// bus is our controller for the bus application. It handles drawing to the
// screen and managing objects.
var bus = new Bus();
var util = require("./util.js");
var Stop = require("./stop.js");
var Route = require("./route.js");
var Bezier = require("bezier-js");

/*
var homeControl = L.Control.extend({
    options: {
        position: 'bottomright'
    },

    onAdd: function(map) {
        return $("<button id='geolocate' type='button' class='btn btn-primary' onclick='bus.geolocate();'><span class='glyphicon glyphicon-screenshot'></span></button>")[0];
    }
});

var refreshControl = L.Control.extend({
    options: {
        position: 'bottomright'
    },

    onAdd: function(map) {
        return $("<button id='refresh' type='button' class='btn btn-success' onclick='bus.getHere();'><span class='glyphicon glyphicon-refresh'></span></button>")[0];
    }
});
*/

function Bus() {
    var self = this;

    // lat, lon is the center of our request. We send this to the Bus API
    // and also use it to draw the map. We can get this value from the
    // HTML5 location API.
    //

    // JSON-encoded Bloom filter (of routes that we have loaded) as 
    // returned by "here" API. Send this back to each "here" request
    // for an update.
    self.filter = '';

    // tileURL is passed to Leaflet JS for drawing the map
    self.tileURL = 'https://stamen-tiles.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png';

    // tileOptions is passed to Leatlef JS for drawing the map
    self.tileOptions = {
        maxZoom: 18,
        minZoom: 5,
        opacity: 0.8,
    };

    // mapOptions is the initial options sent on creation of the map
    self.mapOptions = {
        maxZoom: 18,
        minZoom: 5,
        zoom: 16,

        // default to Times Square
        center: [40.758895, -73.9873197]
    };

    // map is our Leaflet JS map object
    self.map = null;

    // stopList is the list of results in the order returned by the API 
    // (i.e., distance from location)
    self.stopList = [];

    // routes is a mapping from route_id to route object
    self.routes = {};

    // rows is stop ids mapped to rows in the results table
    self.rows = {};

    // current_stop is current stop that is clicked
    self.current_stop = null;

    // The current clicked trip
    self.clickedTripLayer = L.layerGroup();

    // Train route shapes
    self.trainRouteLayer = L.layerGroup();

    // Bus route shapes
    self.busRouteLayer = L.layerGroup();

    // The zoom level at which busRouteLayer is visible
    self.minBusZoom = 13;

    // true while updating
    self.updating = false;

    // Avoid weird iPhone bouncing: http://stackoverflow.com/a/26853900
    //self.firstMove = false;
}

// init is run when the page initially loads
Bus.prototype.init = function() {
    var self = this;

    // Avoid weird iPhone bouncing: http://stackoverflow.com/a/26853900
    /*
    window.addEventListener('touchstart', function(e) {
        self.firstMove = true;
    });
    window.addEventListener('touchmove', function(e) {
        if (self.firstMove) {
            e.preventDefault();

            self.firstMove = false;
        }
    });
    */

    self.map = L.map('map', self.mapOptions);

    // Add our tiles
    L.tileLayer(self.tileURL, self.tileOptions).addTo(self.map);

    // Create "you are here" marker
    self.marker = L.marker([0, 0]);

    // Set up event handler
    self.map.on("moveend", function() {
        //self.getHere();

        // Add/remove bus layer at the appropriate zoom levels
        if (self.map.getZoom() >= self.minBusZoom) {
            if (!self.map.hasLayer(self.busRouteLayer)) {
                self.map.addLayer(self.busRouteLayer);
            }
        } else {
            if (self.map.hasLayer(self.busRouteLayer)) {
                self.map.removeLayer(self.busRouteLayer);
            }
        }

    });

    self.marker.addTo(self.map);
    self.clickedTripLayer.addTo(self.map);
    self.trainRouteLayer.addTo(self.map);
    self.busRouteLayer.addTo(self.map);

    /*
    self.map.addControl(new homeControl());
    self.map.addControl(new refreshControl());
    */

    self.geolocate();

    self.test();
};

// geolocate requests the location from the browser and sets the location
Bus.prototype.geolocate = function() {
    var self = this;

    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(p) {
            // Set location of "you are here" and map view
            self.marker.setLatLng([p.coords.latitude, p.coords.longitude]);
            self.map.setView([p.coords.latitude, p.coords.longitude]);
        });
    }
};

// parseHere reads the text of response from the here API and updates
// stops and routes
Bus.prototype.parseHere = function(data) {
    var self = this;

    if (data.stops) {
        // Reset list of stops
        self.stopList = [];

        // Create a stop object for each result and save to our list
        for (var i = 0; i < data.stops.length; i++) {
            var s = new Stop(data.stops[i]);
            self.stopList[i] = s;
        }
    }

    if (data.routes) {
        for (var i = 0; i < data.routes.length; i++) {
            var r = new Route(data.routes[i]);
            self.routes[r.api.unique_id] = r;
        };
    }

    if (data.filter) {
        self.filter = JSON.stringify(data.filter);
    }
};

// createRow creates a results row for this stop
Bus.prototype.createRow = function(stop, i) {
    var self = this;

    var route = self.routes[stop.api.agency_id + "|" + stop.api.route_id];

    var opacity = 0;
    if (self.current_stop && stop.id == self.current_stop.id) {
        opacity = stop.table_fg_opacity;
    } else {
        opacity = stop.table_bg_opacity;
    }

    var cellCSS = {
        "color": route.api.route_text_color,
        "background-color": route.api.route_color,
        "opacity": opacity
    };

    // Create our row object
    var row = $("<tr>");
    $(row).css(cellCSS);

    // Create and append the cell containing the route identifier
    // with colored background
    var routeID = null;
    if (stop.live == true) {
        routeID = $("<td class='rowroute'>" + stop.api.route_id + "<br><img src='img/radio.png' width=20 height=20></td>");
    } else {
        routeID = $("<td class='rowroute'>" + stop.api.route_id + "</td>");
    }


    var datatd = $("<td>");
    var headsign = $('<span class="headsign">' + stop.api.headsign + '</span>');
    var departures = $('<span><br>' + stop.departures + '</span>');
    $(row).append(routeID);
    $(datatd).append(headsign);
    $(datatd).append(departures);
    $(row).append(datatd);


    return row;
};

// clear removes the current route from map
Bus.prototype.clear = function() {
    var self = this;

    // Nothing to do
    if (self.layer == null || self.map == null) {
        return
    }

    self.layer.clearLayers();
};

// clickHandler highlights the marker and the row for this stop_id
Bus.prototype.clickHandler = function(stop) {
    var self = this;

    return function(e) {

        // If it's the current stop, then just recenter
        if (self.current_stop && self.current_stop.id == stop.id) {
            self.map.setView([stop.api.lat, stop.api.lon]);
            return;
        } else if (self.current_stop) {
            $(self.rows[self.current_stop.id]).css({
                "opacity": self.current_stop.table_bg_opacity
            });
        }

        var route = self.routes[stop.api.agency_id + "|" + stop.api.route_id];
        var row = self.rows[stop.id];
        var markers = route.createMarkers(stop.api);
        var lines = route.createLines(stop.api);
        var vehicles = route.createVehicles(stop.api);
        $(row).css({
            "opacity": stop.table_fg_opacity
        });

        // First clear the map of any existing routes
        self.clear();

        var vals = [];

        // Draw lines 
        for (var i = 0; i < lines.length; i++) {
            vals.push(lines[i]);
        }

        // Draw marker stops
        for (var key in markers) {
            vals.push(markers[key]);
        }

        // Draw vehicles
        for (var key in vehicles) {
            vals.push(vehicles[key]);
        }

        self.layer = L.layerGroup(vals);
        self.layer.addTo(self.map);

        self.current_stop = stop;
    };
}

// updateStops runs any manipulation necessary after parsing stops
// into stopList
Bus.prototype.updateStops = function() {
    var self = this;

    // Reset rows
    self.rows = {};

    // Create new table
    var table = $("<table class='table'>");
    var tbody = $("<tbody>");
    var results = $("#results");

    // If there's a current stop, show it first
    if (self.current_stop != null) {
        self.stopList.unshift(self.current_stop);
    }

    for (var i = 0; i < self.stopList.length; i++) {
        // create the stop row and markers
        var stop = self.stopList[i];

        // If the current stop shows up after first, then ignore it
        if (i != 0 && self.current_stop && self.current_stop.id == stop.id) {
            continue;
        }

        var row = self.createRow(stop, i);

        // Put into row
        self.rows[stop.id] = row;

        // Add to row display
        $(tbody).append(row);

        /* FIXME: ignore this for now
        var handler = self.clickHandler(stop);
        $(row).click(handler);
        */
    }

    // Set first result to current stop if none selected
    if (self.current_stop == null && self.stopList.length > 0) {
        var row = self.rows[self.stopList[0].id];
        $(row).trigger("click");
    }

    // Destroy and recreate results
    $(table).append(tbody);
    $(results).empty();
    $(results).append(table);
};

Bus.prototype.updateRoutes = function() {
    var self = this;
    var layer = null;

    // Go through each route and add to appropriate layer
    // if it hasn't already been added.
    for (var key in self.routes) {
        var route = self.routes[key];

        if (route.api.route_type_name == "bus") {
            layer = self.busRouteLayer;
        } else {
            layer = self.trainRouteLayer;
        }

        for (var i = 0; i < route.routeLines.length; i++) {
            var line = route.routeLines[i];
            if (!layer.hasLayer(line)) {
                layer.addLayer(line);
            }
        }
    };

};

// getHere calls the here API with our current state and updates
// the UI with the results
Bus.prototype.getHere = function() {
    var self = this;

    // Don't update more than once at a time
    if (self.updating) {
        return;
    }

    self.updating = true;

    var center = self.map.getCenter();
    var bounds = self.map.getBounds();
    var sw = bounds.getSouthWest();
    var ne = bounds.getNorthEast();

    var url = '/api/here' +
        '?lat=' + encodeURIComponent(center.lat) +
        '&lon=' + encodeURIComponent(center.lng) +
        '&sw_lat=' + encodeURIComponent(sw.lat) +
        '&sw_lon=' + encodeURIComponent(sw.lng) +
        '&ne_lat=' + encodeURIComponent(ne.lat) +
        '&ne_lon=' + encodeURIComponent(ne.lng) +
        '&filter=' + encodeURIComponent(self.filter);

    $.ajax(url, {
        dataType: "json",
        success: function(data) {
            self.parseHere(data);
            self.updateStops();
            self.updateRoutes();
            self.updating = false;
        },

        error: function(xhr, stat, err) {
            console.log("error executing here request");
            console.log(xhr, stat, err);
            self.updating = false;
        }
    });
};

Bus.prototype.test = function() {
    var self = this;

    var weird_test2 = [
        [40.6329432173858, -73.9466477643981],
        [40.6400737076317, -73.9474167094267],
        [40.6452041978311, -73.9479646549791],
        [40.6509496125663, -73.948580699361],
        [40.656758551939, -73.9492056927715],
        [40.6628441945859, -73.9498552277009],
        [40.6640252564155, -73.9499718388689],
        [40.6640391904366, -73.9499733132758],
        [40.6640917747993, -73.9499792502199],
        [40.6641368878776, -73.949983479571],
        [40.6641861514352, -73.9499871559559],
        [40.664232025363, -73.9499898153141],
        [40.6642809286887, -73.9499911928725],
        [40.6643398489939, -73.949992],
        [40.6643961815937, -73.949992],
        [40.6644556768551, -73.9499904744805],
        [40.6645251314198, -73.9499879020892],
        [40.6645962763655, -73.949984431604],
        [40.6646659841607, -73.9499803311455],
        [40.6647385869389, -73.9499745559245],
        [40.6648185545462, -73.949967367825],
        [40.6648919790956, -73.9499601849886],
        [40.6649713681133, -73.9499500502204],
        [40.6650054013606, -73.9499462964839],
        [40.6677904013606, -73.9496872964839],
        [40.6677958542467, -73.949686804428],
        [40.6683744821534, -73.9496361868924],
        [40.6690185983778, -73.9495741389992],
        [40.6691060893938, -73.9495647313631],
        [40.6691900175663, -73.949559264131],
        [40.6692770175663, -73.949557264131],
        [40.6694584658995, -73.9495696355492],
        [40.6695394658995, -73.9495826355492],
        [40.6697046876791, -73.9496238360151],
        [40.6697806876791, -73.9496498360151],
        [40.669928876779, -73.9497143354916],
        [40.669999876779, -73.9497523354916],
        [40.670143644042, -73.9498459756263],
        [40.670207644042, -73.9498959756263],
        [40.6703215372042, -73.9500000588712],
        [40.6703815372042, -73.9500640588712],
        [40.670468665981, -73.9501708893734],
        [40.670521665981, -73.9502458893733],
        [40.6705851533541, -73.9503483105506],
        [40.6706331533541, -73.9504373105506],
        [40.6706763471697, -73.9505280338502],
        [40.6707183471697, -73.9506290338502],
        [40.6707453519164, -73.9507018228238],
        [40.6707823519164, -73.9508148228238],
        [40.6708030423902, -73.9508870927452],
        [40.6708340423902, -73.9510130927452],
        [40.67084595215, -73.9510681384468],
        [40.67087195215, -73.9512071384468],
        [40.6708803422032, -73.9512596963969],
        [40.6709003422032, -73.9514106963969],
        [40.6709058729975, -73.9514629795794],
        [40.6709188729975, -73.9516269795794],
        [40.6709205697157, -73.951652534844],
        [40.6710815697157, -73.954659534844],
        [40.6710818428894, -73.9546649075646],
        [40.6710940801036, -73.9549190650914],
        [40.6711125562746, -73.9551500172284],
        [40.6711447721379, -73.9553846147975],
        [40.6711898707417, -73.9556330992611],
        [40.6716612056343, -73.957928122325],
        [40.6729641023934, -73.9641620590021],
        [40.6738887366557, -73.9682372250933],
        [40.6739210212917, -73.968371206333],
        [40.6739521037822, -73.9684757565281],
        [40.6739861177068, -73.9685760080953],
        [40.6740210495701, -73.968651783368],
        [40.6740737831121, -73.9687554320541],
        [40.6741133584145, -73.9688154473478],
        [40.6741771632723, -73.9688981162506],
        [40.6742500671828, -73.9689763030531],
        [40.6743217240069, -73.9690394964728],
        [40.675840241828, -73.9702496263559],
        [40.6814156211533, -73.9742881385164],
        [40.6814172806607, -73.9742893431728],
        [40.6849472806607, -73.9768573431728],
        [40.6849500685259, -73.9768593786528],
        [40.6863696864984, -73.9778996331727],
        [40.6888279253623, -73.9796787399205],
        [40.6890525226744, -73.9798376253553],
        [40.6890705587273, -73.9798506882284],
        [40.6891220771811, -73.9798888829442],
        [40.6891755189414, -73.9799271828724],
        [40.6892193911083, -73.9799604910652],
        [40.6892753911083, -73.9800054910652],
        [40.6892997913735, -73.9800257433977],
        [40.6893557913735, -73.9800737433977],
        [40.6894052086669, -73.9801190617514],
        [40.6894572086669, -73.9801700617514],
        [40.6895022413135, -73.9802172051405],
        [40.6895532413135, -73.9802742051405],
        [40.6895888688095, -73.9803163049525],
        [40.6896368688095, -73.9803763049525],
        [40.6896680153713, -73.9804173639518],
        [40.6897140153713, -73.9804813639518],
        [40.6897471934236, -73.9805305394527],
        [40.6897901934236, -73.9805985394527],
        [40.6898087789009, -73.9806291289745],
        [40.6898507789009, -73.9807011289745],
        [40.6898693529411, -73.9807344117646],
        [40.6899093529411, -73.9808094117646],
        [40.6899431573349, -73.980879181166],
        [40.6899781573349, -73.980959181166],
        [40.6899889468132, -73.9809848072423],
        [40.6900229468132, -73.9810688072423],
        [40.6900244766909, -73.9810726093236],
        [40.6900584766909, -73.9811576093236],
        [40.690061400646, -73.9811650043453],
        [40.6900938896918, -73.9812481380802],
        [40.6914733339871, -73.9846932527613],
        [40.6931015574125, -73.9887588773143],
        [40.6931120654743, -73.9887777918256],
        [40.693121032157, -73.9887927362968],
        [40.6931241252404, -73.9887974863891],
        [40.6931345431838, -73.9888117242451],
        [40.6931440346273, -73.9888243795031],
        [40.6931490389949, -73.9888298254325],
        [40.6931590073166, -73.9888397937542],
        [40.693167971331, -73.9888482597678],
        [40.6931788836419, -73.9888559782316],
        [40.6931861247244, -73.9888607467494],
        [40.6936667091732, -73.9891038115764],
        [40.6943490761935, -73.9894420109742],
        [40.6943522135957, -73.9894435728091],
        [40.6943781651207, -73.9894565485716],
        [40.6944040063055, -73.9894687513533],
        [40.6944352648484, -73.9894835123319],
        [40.6944572574018, -73.9894936170186],
        [40.6944839111507, -73.989505142964],
        [40.6945061378149, -73.9895147544945],
        [40.6945291665349, -73.9895238447787],
        [40.6945500570001, -73.9895323646249],
        [40.6945670713969, -73.9895395285814],
        [40.6945837053587, -73.9895456568831],
        [40.6945969790794, -73.9895506543938],
        [40.6946254661219, -73.9895616109486],
        [40.6946430891275, -73.9895679371558],
        [40.6946712277659, -73.9895773167019],
        [40.6946928647534, -73.9895848053292],
        [40.6947068275327, -73.9895898176089],
        [40.6947213478855, -73.9895941737148],
        [40.6947430860726, -73.9896009659313],
        [40.694777347489, -73.9896121008917],
        [40.6966588177729, -73.9901985718504],
        [40.6967219999999, -73.990217],
        [40.696750177011, -73.9902256709665],
        [40.696821177011, -73.9902486709666],
        [40.6968672270625, -73.9902648405547],
        [40.6969332270625, -73.9902898405547],
        [40.6970034338762, -73.990319541064],
        [40.6970674338762, -73.990349541064],
        [40.6971128490815, -73.9903722532409],
        [40.6971748490815, -73.9904052532409],
        [40.6972822358177, -73.9904714225017],
        [40.6973402358177, -73.9905124225017],
        [40.6973962377902, -73.9905550427008],
        [40.6974512377902, -73.9906000427008],
        [40.6975038011466, -73.9906462110282],
        [40.6975558011465, -73.9906952110283],
        [40.6976174093187, -73.9907586361612],
        [40.6976654093187, -73.9908126361612],
        [40.6977066319326, -73.9908621344253],
        [40.6977526319326, -73.9909211344253],
        [40.6977899498735, -73.9909722564355],
        [40.6978329498735, -73.9910352564355],
        [40.6978744570263, -73.991101487882],
        [40.6979134570263, -73.9911694878821],
        [40.6979379700836, -73.991214905574],
        [40.6979749700836, -73.991287905574],
        [40.6980002618298, -73.9913417152581],
        [40.6980332618298, -73.9914177152581],
        [40.69804605199, -73.9914485720534],
        [40.69807805199, -73.9915295720534],
        [40.6981147633339, -73.9916413270522],
        [40.6981463660973, -73.9917608250014],
        [40.698431017351, -73.9928237884244],
        [40.7011307616754, -74.0026178387356],
        [40.7013691763645, -74.0033282953593],
        [40.7015677732765, -74.0038978563144],
        [40.7017346803223, -74.0042870178203],
        [40.7019467788047, -74.0047067960667],
        [40.7022012084699, -74.0051421739053],
        [40.7024309356685, -74.0055108059216],
        [40.7027043953611, -74.0058813821405],
        [40.7032149544658, -74.0064666341514],
        [40.7053193291808, -74.008840672451],
        [40.7053314072545, -74.0088545534608],
        [40.7054040133668, -74.0089395646375],
        [40.7054512722263, -74.0089173251742],
        [40.7055752569092, -74.0088431608205],
        [40.7057393773685, -74.0087155115744],
        [40.706157148885, -74.0083520690892],
        [40.7066963419928, -74.0078638157937],
        [40.707108086806, -74.0074607089836],
        [40.7087097759978, -74.0058630115406],
        [40.7087238376996, -74.0058492581141],
        [40.7094558376996, -74.0051472581141],
        [40.7095733695785, -74.0050505869755],
        [40.7096203695785, -74.0050175869755],
        [40.709706847138, -74.0049632418529],
        [40.709765847138, -74.0049302418529],
        [40.7098619015593, -74.0048830767354],
        [40.7099229015593, -74.0048570767354],
        [40.7100913075894, -74.0048023402104],
        [40.7101523075894, -74.0047883402104],
        [40.7103432307233, -74.004763537057],
        [40.7104042307233, -74.004761537057],
        [40.7106202824284, -74.004777939701],
        [40.7106792824284, -74.004788939701],
        [40.7108232755069, -74.0048270710383],
        [40.7109600069947, -74.0048861684647],
        [40.7110230069947, -74.0049191684647],
        [40.7111351570204, -74.0049876609713],
        [40.7111961570204, -74.0050306609713],
        [40.7113098256992, -74.0051240245137],
        [40.7114158256992, -74.0052250245137],
        [40.7114525009104, -74.005261834498],
        [40.7122938637312, -74.0061513594428],
        [40.7123441580982, -74.0062001889253],
        [40.7123872874137, -74.0062341061541],
        [40.712724725882, -74.0064741884256],
        [40.712802368752, -74.0065354309429],
        [40.71288861447, -74.0066106665692],
        [40.7129787226326, -74.0066860631951],
        [40.7130478381371, -74.0067496443696],
        [40.7131418381371, -74.0068446443696],
        [40.7132350357006, -74.0069534189777],
        [40.7133230357006, -74.0070724189777],
        [40.7134035236506, -74.00720050465],
        [40.7134805236506, -74.00734650465],
        [40.7135080360007, -74.007402889852],
        [40.7135737868322, -74.0075491118506],
        [40.7139605207645, -74.0083953415116],
        [40.7139632295503, -74.008401320555],
        [40.7142231017319, -74.008979975614],
        [40.7148149882028, -74.0085159658497],
        [40.7148509905947, -74.0084869883148],
        [40.7148582262029, -74.0084812194954],
        [40.7174122262029, -74.0064642194954],
        [40.717453252994, -74.0064334928553],
        [40.717484252994, -74.0064114928553],
        [40.7175143435584, -74.0063909520892],
        [40.7175463435584, -74.0063699520892],
        [40.7175650010602, -74.0063580016959],
        [40.7175970010602, -74.0063380016959],
        [40.7176280355549, -74.0063193775433],
        [40.7176610355549, -74.0063003775433],
        [40.7177020434103, -74.0062780254435],
        [40.7177350434104, -74.0062610254435],
        [40.7177560960373, -74.0062504918414],
        [40.7177910960373, -74.0062334918414],
        [40.7178022029636, -74.0062281812978],
        [40.7178362029636, -74.0062121812978],
        [40.717899553739, -74.0061849953284],
        [40.7179355537388, -74.0061709953285],
        [40.7179715537387, -74.0061569953285],
        [40.718017772234, -74.0061403167019],
        [40.718053772234, -74.0061283167019],
        [40.7180919419234, -74.0061164357356],
        [40.7181299419234, -74.0061054357356],
        [40.7181679419235, -74.0060944357356],
        [40.7182155336163, -74.0060819197125],
        [40.7182535336163, -74.0060729197125],
        [40.7182830558561, -74.0060663972994],
        [40.7183220558561, -74.0060583972994],
        [40.7183506196683, -74.0060529695328],
        [40.7183824944692, -74.0060473914427],
        [40.719129393832, -74.0059039471942],
        [40.7191482704129, -74.0059005093267],
        [40.7226842704129, -74.0052915093267],
        [40.7226877347113, -74.0052909189416],
        [40.7280847347113, -74.0043809189416],
        [40.7280964468724, -74.004379015521],
        [40.7287755199777, -74.0042727862487],
        [40.7289837122081, -74.0042380875436],
        [40.7290438156277, -74.0042254341921],
        [40.7290886942162, -74.0042127585603],
        [40.7291365389962, -74.0041932962769],
        [40.729200053936, -74.0041644258497],
        [40.7293970068465, -74.0040597688638],
        [40.7298225288758, -74.0038150936969],
        [40.7298240174933, -74.0038142394408],
        [40.7329250174933, -74.0020382394408],
        [40.7329268149497, -74.0020372124736],
        [40.7354778149497, -74.0005832124736],
        [40.7354803359876, -74.0005817803893],
        [40.7356609611463, -74.0004795217015],
        [40.7358408295403, -74.0003730689785],
        [40.7360472545232, -74.0002457584164],
        [40.7361921091928, -74.0001502860206],
        [40.7372390760981, -73.9993913578976],
        [40.7404522366883, -73.9970619664306],
        [40.743491551229, -73.9948491935292],
        [40.7466246864067, -73.9925578260029],
        [40.7497829449519, -73.9902496369836],
        [40.7497863374458, -73.9902471685067],
        [40.7547033374458, -73.9866851685067],
        [40.7567478203706, -73.9852046121415],
        [40.7570362744727, -73.9849872970579],
        [40.7570979515583, -73.984944366065],
        [40.7572179515583, -73.9848673660649],
        [40.7572550101936, -73.9848447076567],
        [40.7573770101936, -73.9847737076567],
        [40.757422202305, -73.9847489436067],
        [40.757556202305, -73.9846799436067],
        [40.7576414828059, -73.9846409747094],
        [40.7577778690791, -73.9845862281067],
        [40.7579912830231, -73.9844975492533],
        [40.7580400629455, -73.9844787594949],
        [40.7582960629455, -73.9843877594949],
        [40.7583048963982, -73.9843846659633],
        [40.7590788963982, -73.9841176659633],
        [40.7590860131093, -73.9841152408726],
        [40.7593728748081, -73.9840186919513],
        [40.7596355358388, -73.9839164015169],
        [40.7598670164445, -73.9838154550874],
        [40.7601241620768, -73.9836922914836],
        [40.7602866036212, -73.9835979477045],
        [40.7604749109943, -73.9834689700517],
        [40.7604969005426, -73.9834543316254],
        [40.7611846180057, -73.9830095143709],
        [40.7619423310918, -73.9825187002215],
        [40.7624363261174, -73.9821987034437],
        [40.762486682633, -73.9821681506019],
        [40.762918682633, -73.9819231506019],
        [40.762928080243, -73.9819178876251],
        [40.763230080243, -73.9817508876251],
        [40.7632566519874, -73.9817367121977],
        [40.7635716519874, -73.9815747121977],
        [40.7636549235485, -73.9815366021305],
        [40.7640119235485, -73.9813926021305],
        [40.7640332269793, -73.9813842910731],
        [40.7644682269793, -73.9812202910731],
        [40.7645284618178, -73.9811997461572],
        [40.7648324618178, -73.9811067461572],
        [40.7648770408845, -73.9810942295024],
        [40.7652130408846, -73.9810082295024],
        [40.7652714180174, -73.9809951351051],
        [40.7656184180174, -73.9809281351051],
        [40.7656548290456, -73.9809218002941],
        [40.7666548290456, -73.9807668002941],
        [40.7666639149416, -73.9807654346935],
        [40.7670279149416, -73.9807124346934],
        [40.7670867847804, -73.9807056374323],
        [40.7672387847804, -73.9806926374323],
        [40.7673670634629, -73.9806899276612],
        [40.7674739274541, -73.9806945338677],
        [40.7675857857715, -73.9806973072144],
        [40.7677333803318, -73.9807119695328],
        [40.7678533803318, -73.9807329695329],
        [40.767949156063, -73.9807546245146],
        [40.768046156063, -73.9807816245146],
        [40.7680720858488, -73.9807892209913],
        [40.7681890858488, -73.9808252209913],
        [40.7682825886394, -73.9808591675604],
        [40.7686269025453, -73.9810039359072],
        [40.7687930359968, -73.9810705498033],
        [40.7688430857009, -73.9810865813491],
        [40.7688538005101, -73.9810889518821],
        [40.7688560210311, -73.9810891761772],
        [40.7692453581112, -73.9810982728379],
        [40.7692483066821, -73.9810983460806],
        [40.7734552213108, -73.9812090543603],
        [40.7741499033277, -73.9812119249472],
        [40.7774337380495, -73.9810926024243],
        [40.7777525113314, -73.9810643999623],
        [40.778061103297, -73.9810192841779],
        [40.7782899823805, -73.9809833444871],
        [40.7786165479705, -73.9809267043848],
        [40.7791703943799, -73.9807900767109],
        [40.7807005749069, -73.9803583123966],
        [40.781829676005, -73.9799783732868],
        [40.782022628095, -73.9799105316844],
        [40.782216647836, -73.9798330802555],
        [40.7823428708164, -73.9797714364744],
        [40.7824963164325, -73.979691226266],
        [40.782642609282, -73.9796103156956],
        [40.782753057761, -73.9795416221294],
        [40.78333916626, -73.9791131305697],
        [40.7863295049861, -73.9768735956709],
        [40.7869534471456, -73.976344978008],
        [40.7879889189865, -73.9754623946268],
        [40.7882956161632, -73.9751919523879],
        [40.7883677348297, -73.9751340602998],
        [40.7933297348297, -73.9715150602998],
        [40.7933598583316, -73.9714939278712],
        [40.7934304682396, -73.9714463072356],
        [40.7978789935942, -73.9681996052161],
        [40.7979630235949, -73.9681254270086],
        [40.7980393701159, -73.9680479059257],
        [40.798102846548, -73.9679717342072],
        [40.7981528766758, -73.967901191727],
        [40.7981912639636, -73.9678344709649],
        [40.7982215211642, -73.9677692018609],
        [40.7982445682354, -73.9677026214329],
        [40.7982617608849, -73.9676338508347],
        [40.7982722936925, -73.9675618766495],
        [40.7982769804749, -73.9674826700278],
        [40.7982740244127, -73.9673969442266],
        [40.7982623892492, -73.9672983223643],
        [40.798240758402, -73.9671883655578],
        [40.7982073648834, -73.9670659226561],
        [40.7981638463588, -73.9669380451453],
        [40.7962627666155, -73.9624360103487],
        [40.7962581227132, -73.9624248243637],
        [40.7961671227132, -73.9622018243637],
        [40.7961625916072, -73.9621905245184],
        [40.7960715916072, -73.9619595245184],
        [40.7960528547211, -73.961907838434],
        [40.7959848547211, -73.961702838434],
        [40.7959566934685, -73.9615998299871],
        [40.7959126934685, -73.9613968299871],
        [40.795893985844, -73.9612741952975],
        [40.795875985844, -73.9610731952975],
        [40.7958736893909, -73.9609258972661],
        [40.7958846893909, -73.9607368972661],
        [40.7958874442649, -73.9607008258089],
        [40.7959084442649, -73.9604788258088],
        [40.7959172742354, -73.9604106046016],
        [40.7965482742354, -73.9565766046016],
        [40.7965522260244, -73.9565541884395],
        [40.7971275357854, -73.9534948589294],
        [40.7971928729826, -73.9531325344723],
        [40.7972057330251, -73.95307200743],
        [40.7972797330251, -73.95277000743],
        [40.7973051353681, -73.9526834386067],
        [40.7974101353681, -73.9523774386067],
        [40.7974569710129, -73.9522641108813],
        [40.7975699710129, -73.9520321108813],
        [40.7976171441204, -73.9519462237497],
        [40.7977081441204, -73.9517982237497],
        [40.7977444089631, -73.9517433712238],
        [40.7978494089631, -73.9515953712238],
        [40.7979766839492, -73.9514485890722],
        [40.7981526839492, -73.9512815890722],
        [40.7982208123878, -73.9512225464796],
        [40.7984548123878, -73.9510375464796],
        [40.7984870988208, -73.9510130672441],
        [40.801509190758, -73.9488167271892],
        [40.8071642841746, -73.9446873891746],
        [40.8136395309299, -73.9399622090521],
        [40.8136403642087, -73.939961601642],
        [40.8177000824888, -73.93700551513],
        [40.8177349852558, -73.9369671793039],
        [40.8178147145285, -73.9368692661621],
        [40.8178869961852, -73.9367701370328],
        [40.8179537210668, -73.9366665744562],
        [40.8180152497338, -73.9365595984784],
        [40.8180697692377, -73.9364512495908],
        [40.8181185440602, -73.9363399605593],
        [40.8181612498825, -73.9362249303606],
        [40.8181985956416, -73.9361051420764],
        [40.81823074324, -73.9359794092472],
        [40.8182569513948, -73.9358490964776],
        [40.8182775972374, -73.9357134237979],
        [40.8182916064307, -73.9355748065168],
        [40.818299, -73.9354321106285],
        [40.818299, -73.93526],
        [40.8182990458565, -73.935250423424],
        [40.8183348566566, -73.9315111790382],
        [40.8183307078361, -73.9313726084321],
        [40.818323536891, -73.9312211222173],
        [40.8183134939656, -73.9310668263632],
        [40.8183013763801, -73.9309092977519],
        [40.8182878655832, -73.9307561753872],
        [40.8182707926419, -73.9306025189155],
        [40.8182511580941, -73.9304435725763],
        [40.818230012669, -73.9302854415705],
        [40.8182065757746, -73.930131298919],
        [40.8181797719046, -73.9299723242422],
        [40.8181511552866, -73.9298126250509],
        [40.8181198412091, -73.929653291657],
        [40.8180865340529, -73.9294932322675],
        [40.8180505453679, -73.9293326673649],
        [40.8180133782168, -73.9291758401179],
        [40.8177170182109, -73.9280330204293],
        [40.8174418150688, -73.926968235767],
        [40.8174414222091, -73.926966710802],
        [40.8151456635094, -73.9180261224891],
        [40.8148247600812, -73.9169642952435],
        [40.8148173579265, -73.9169385634081],
        [40.8147673579265, -73.9167555634081],
        [40.8147415951046, -73.9166301960319],
        [40.8147115951046, -73.9164151960319],
        [40.8147033741397, -73.9163294060218],
        [40.8146853741397, -73.9159864060218],
        [40.8146857392057, -73.9158750475909],
        [40.8147007392057, -73.9156210475909],
        [40.8147173604054, -73.9154892548655],
        [40.8147583604054, -73.9152782548655],
        [40.8147823721135, -73.9151809916131],
        [40.8148623721135, -73.9149149916131],
        [40.8148818477073, -73.9148567771301],
        [40.8149748477073, -73.9146047771301],
        [40.8149889831676, -73.9145686482073],
        [40.8150365619602, -73.914453666125],
        [40.8150735817179, -73.9143636408053],
        [40.8151585324015, -73.9141349274264],
        [40.8151915565351, -73.9140204082533],
        [40.8152047592934, -73.9139310695889],
        [40.8152116149604, -73.9137973840817],
        [40.8152032986724, -73.9136435327529],
        [40.815184311212, -73.9134211082171],
        [40.8151181285875, -73.9127701477764],
        [40.8151176462648, -73.9127652857301],
        [40.8150376462648, -73.9119382857301],
        [40.8150364737382, -73.9119252791069],
        [40.8149774737382, -73.9112192791069],
        [40.8149758538446, -73.9111968625704],
        [40.8149508538446, -73.9107868625704],
        [40.8149502339383, -73.9107756624009],
        [40.8149322339383, -73.9104136624009],
        [40.814931, -73.910364],
        [40.814931, -73.9100911233284],
        [40.8149261664564, -73.9098262451377],
        [40.8149262930077, -73.9097837940195],
        [40.8149362930077, -73.9093707940196],
        [40.8149404887869, -73.9093003563283],
        [40.8149674887869, -73.9090163563283],
        [40.814980993553, -73.9089221526064],
        [40.815020993553, -73.9087141526064],
        [40.8150295828317, -73.9086739606663],
        [40.8150815828317, -73.9084529606663],
        [40.8151225969118, -73.9083205799104],
        [40.8152415969118, -73.9080135799104],
        [40.8153001331627, -73.9078888346468],
        [40.8156161331627, -73.9073208346468],
        [40.8156267094249, -73.907302292775],
        [40.8167079163134, -73.9054529122424],
        [40.816921875838, -73.9050632327677],
        [40.8170937979968, -73.9046995858979],
        [40.8174840288017, -73.9038087559795],
        [40.8174859485292, -73.903804401789],
        [40.8179039485292, -73.902862401789],
        [40.8179263522923, -73.9028152700968],
        [40.8182213522923, -73.9022342700968],
        [40.8182238699917, -73.9022293452957],
        [40.8186958699917, -73.9013123452957],
        [40.8212921413956, -73.8962778183636],
        [40.8231834623501, -73.8926071362573],
        [40.8233328664575, -73.8923153002342],
        [40.8233343793429, -73.8923123570802],
        [40.8235423793429, -73.8919093570802],
        [40.8235779229631, -73.8918462150163],
        [40.8236409229632, -73.8917432150163],
        [40.8236835783216, -73.8916791530035],
        [40.8237435783216, -73.8915961530035],
        [40.8238622597562, -73.8914598535917],
        [40.8239572597562, -73.8913688535917],
        [40.8240350593865, -73.8913016477826],
        [40.8241250593865, -73.8912316477826],
        [40.8242609270243, -73.8911426798819],
        [40.8243399270243, -73.8910996798819],
        [40.8244582677324, -73.8910449444306],
        [40.8245412677324, -73.8910129444306],
        [40.8246979995494, -73.8909668213559],
        [40.8247799995494, -73.8909498213559],
        [40.824901872949, -73.8909322962318],
        [40.824987872949, -73.8909252962318],
        [40.825073414968, -73.890922009746],
        [40.8255185363378, -73.8909239749618],
        [40.8298032597968, -73.8908753750892],
        [40.8298937685191, -73.8908693811341],
        [40.8299646792496, -73.89085992637],
        [40.8300371322274, -73.8908478508737],
        [40.8301313159595, -73.890827108028],
        [40.8303169844922, -73.8907663561919],
        [40.8304569646185, -73.8907074505279],
        [40.830649934427, -73.8906040478381],
        [40.8308254057525, -73.8904936292966],
        [40.8308448964868, -73.8904816732646],
        [40.8361046023072, -73.8873374469188],
        [40.8363048610893, -73.887216912012],
        [40.836464401042, -73.8871160264537],
        [40.8365716890259, -73.8870349773789],
        [40.8365891106415, -73.8870185512842],
        [40.8366369609465, -73.8869701244695],
        [40.8366719831821, -73.8869297727633],
        [40.8368706930466, -73.8866428357189],
        [40.8380658914237, -73.8846250826486],
        [40.8381638182037, -73.8844460602539],
        [40.8382443484338, -73.8842605249199],
        [40.8383147627162, -73.8840905594106],
        [40.8383848773156, -73.8838809946635],
        [40.8384458516815, -73.8836584778218],
        [40.8384972211459, -73.8834071625959],
        [40.8385272199069, -73.8831801449451],
        [40.8385482959051, -73.8829584254444],
        [40.8385681739983, -73.8825485580923],
        [40.8385687426254, -73.8825379897119],
        [40.8385927426254, -73.8821319897119],
        [40.8385957884088, -73.8820932560044],
        [40.8386177884088, -73.8818692560044],
        [40.8386225799542, -73.8818289125898],
        [40.8386515799542, -73.8816209125898],
        [40.838665227237, -73.8815447222144],
        [40.838742227237, -73.8811937222144],
        [40.8387667040118, -73.8811028240656],
        [40.8388497040118, -73.8808438240656],
        [40.8388645162618, -73.8808009709199],
        [40.8389755162618, -73.8805019709199],
        [40.8389874530438, -73.8804713671543],
        [40.8391314530438, -73.8801193671543],
        [40.8391478011223, -73.8800816378971],
        [40.8392458011223, -73.8798676378971],
        [40.8392751483092, -73.8798087516415],
        [40.8393491483092, -73.8796717516415],
        [40.8393995630729, -73.8795883996205],
        [40.8394655630729, -73.8794903996205],
        [40.8395141311905, -73.8794243049525],
        [40.8396341311906, -73.8792743049524],
        [40.8397142919851, -73.8791855518394],
        [40.8398822919851, -73.8790205518394],
        [40.839889092254, -73.8790139360862],
        [40.8402370036009, -73.8786786625446],
        [40.8402053269062, -73.878599857109],
        [40.8401280668405, -73.8784167221385],
        [40.840024500106, -73.8781727428121],
        [40.8400048093753, -73.878122648777],
        [40.8399548093753, -73.877984648777],
        [40.8399341185372, -73.8779209599511],
        [40.8398851185372, -73.8777509599511],
        [40.8398656820353, -73.8776714251456],
        [40.8398366820353, -73.8775274251456],
        [40.8398265552395, -73.8774679100299],
        [40.8398045552395, -73.87730991003],
        [40.8397965396468, -73.8772274700196],
        [40.8397875396468, -73.8770654700196],
        [40.8397860700182, -73.8770218334909],
        [40.8397840700182, -73.8768528334909],
        [40.8397870546041, -73.876762898287],
        [40.8398040546041, -73.876545898287],
        [40.839811762408, -73.8764776818996],
        [40.839857762408, -73.8761666818996],
        [40.8398617607457, -73.8761418170224],
        [40.8401357607457, -73.8745648170224],
        [40.8401517502154, -73.8744899210391],
        [40.8402007502154, -73.8742969210391],
        [40.8402273180943, -73.87420930729],
        [40.8402673180943, -73.87409630729],
        [40.8402866528303, -73.8740460338502],
        [40.8403286528303, -73.8739450338502],
        [40.840406511097, -73.8737950070086],
        [40.840478511097, -73.8736810070086],
        [40.8405185623599, -73.8736223194724],
        [40.8405965623599, -73.8735163194724],
        [40.8406181845745, -73.8734880061363],
        [40.8411101845745, -73.8728670061363],
        [40.8411125927187, -73.8728639786376],
        [40.8421972706447, -73.8715057315002],
        [40.8424670505822, -73.87116790972],
        [40.8427825180089, -73.8707688484011],
        [40.8428420507066, -73.8707001977628],
        [40.8431850507066, -73.8703391977628],
        [40.8432429771298, -73.8702829627589],
        [40.8434339771298, -73.8701119627589],
        [40.8435118278425, -73.8700489924698],
        [40.8437038278425, -73.8699089924698],
        [40.8438004017802, -73.8698467431449],
        [40.8440124017802, -73.8697267431449],
        [40.8440743979502, -73.8696944581036],
        [40.8443363979502, -73.8695694581036],
        [40.8443688492376, -73.8695546800065],
        [40.8451268492377, -73.8692256800065],
        [40.8451290802355, -73.8692247148917],
        [40.8455720802355, -73.8690337148917],
        [40.8455739420507, -73.8690329144041],
        [40.846361063077, -73.8686954362641],
        [40.8466929479262, -73.8685419933988],
        [40.8470636812703, -73.868328731742],
        [40.8483199813313, -73.867595641366],
        [40.8488259832521, -73.8672940245348],
        [40.8488402570263, -73.8672856754171],
        [40.8491312570263, -73.8671186754171],
        [40.8492151970557, -73.8670756335225],
        [40.8493581970557, -73.8670106335225],
        [40.8494796267188, -73.866964695726],
        [40.8496366267188, -73.866916695726],
        [40.8497409277292, -73.8668908448081],
        [40.8498819277292, -73.8668638448081],
        [40.850003111033, -73.8668482395748],
        [40.850182111033, -73.8668362395748],
        [40.8502174731188, -73.8668344970957],
        [40.8556859810385, -73.8666620063518],
        [40.8571603437586, -73.866615501176],
        [40.8654301669392, -73.8663525067992],
        [40.8713241193694, -73.8661645083165],
        [40.8757959257718, -73.8660254829204],
        [40.8758022142285, -73.8660253072144],
        [40.8761241303189, -73.8660173258238],
        [40.8762282195094, -73.8660061524078],
        [40.8763175480477, -73.8659906916993],
        [40.8763814253047, -73.8659749102593],
        [40.876422709526, -73.8659579542398],
        [40.8764789975203, -73.865926042936],
        [40.8773231992341, -73.8654060068455],
        [40.8811858894098, -73.862997447124],
        [40.8812287786013, -73.8629721643453],
        [40.8834087786013, -73.8617591643453],
        [40.8875364829735, -73.8594667727887],
        [40.8927079746238, -73.8565984999231],
        [40.8927099607105, -73.856597401322],
        [40.8969229177019, -73.8542732500838],
        [40.8971060751416, -73.8541460766162],
        [40.8972524403504, -73.8540219843739],
        [40.8977292577218, -73.8536158434814],
        [40.8989429600456, -73.8525748142678],
        [40.8992759706739, -73.8522876673787],
        [40.8992845086505, -73.852280388399],
        [40.8996155086505, -73.852001388399],
        [40.8996297793275, -73.8519895839364],
        [40.9000227793275, -73.8516705839364],
        [40.9000592332358, -73.8516423627962],
        [40.9002042332358, -73.8515353627962],
        [40.9002367171632, -73.8515123759446],
        [40.9006997171632, -73.8511983759445],
        [40.9007280217292, -73.851179871072],
        [40.9011360217292, -73.850922871072],
        [40.9011396761169, -73.8509205801589],
        [40.9013460660076, -73.8507918147846],
        [40.9014767724393, -73.8507016197031],
        [40.9016304585443, -73.8505833996223],
        [40.9024744982454, -73.8498604952487]
    ];

    var weird_test = [
        [40.632836, -73.947642],
        [40.639967, -73.948411],
        [40.645098, -73.948959],
        [40.650843, -73.949575],
        [40.656652, -73.9502],
        [40.662742, -73.95085],
        [40.663927, -73.950967],
        [40.663989, -73.950974],
        [40.664053, -73.95098],
        [40.66412, -73.950985],
        [40.664189, -73.950989],
        [40.66426, -73.950991],
        [40.664333, -73.950992],
        [40.664409, -73.950992],
        [40.664487, -73.95099],
        [40.664568, -73.950987],
        [40.66465, -73.950983],
        [40.664735, -73.950978],
        [40.664823, -73.950971],
        [40.664912, -73.950963],
        [40.665004, -73.950954],
        [40.665098, -73.950942],
        [40.667883, -73.950683],
        [40.668466, -73.950632],
        [40.66912, -73.950569],
        [40.669213, -73.950559],
        [40.6693, -73.950557],
        [40.669381, -73.95057],
        [40.669457, -73.950596],
        [40.669528, -73.950634],
        [40.669592, -73.950684],
        [40.669652, -73.950748],
        [40.669705, -73.950823],
        [40.669753, -73.950912],
        [40.669795, -73.951013],
        [40.669832, -73.951126],
        [40.669863, -73.951252],
        [40.669889, -73.951391],
        [40.669909, -73.951542],
        [40.669922, -73.951706],
        [40.670083, -73.954713],
        [40.670096, -73.954983],
        [40.670118, -73.955258],
        [40.670157, -73.955542],
        [40.670208, -73.955823],
        [40.670682, -73.958131],
        [40.671987, -73.964375],
        [40.672915, -73.968465],
        [40.672955, -73.968631],
        [40.672999, -73.968779],
        [40.673056, -73.968947],
        [40.673121, -73.969088],
        [40.673208, -73.969259],
        [40.673299, -73.969397],
        [40.673414, -73.969546],
        [40.673552, -73.969694],
        [40.673679, -73.969806],
        [40.675235, -73.971046],
        [40.680829, -73.975098],
        [40.684359, -73.977666],
        [40.685781, -73.978708],
        [40.688246, -73.980492],
        [40.688475, -73.980654],
        [40.688533, -73.980697],
        [40.688593, -73.98074],
        [40.688649, -73.980785],
        [40.688705, -73.980833],
        [40.688757, -73.980884],
        [40.688808, -73.980941],
        [40.688856, -73.981001],
        [40.688902, -73.981065],
        [40.688945, -73.981133],
        [40.688987, -73.981205],
        [40.689027, -73.98128],
        [40.689062, -73.98136],
        [40.689096, -73.981444],
        [40.68913, -73.981529],
        [40.689164, -73.981616],
        [40.690545, -73.985065],
        [40.692195, -73.989185],
        [40.692221, -73.989233],
        [40.692246, -73.989278],
        [40.692273, -73.989323],
        [40.692301, -73.989366],
        [40.692331, -73.989407],
        [40.692361, -73.989447],
        [40.692393, -73.989485],
        [40.692427, -73.989522],
        [40.692462, -73.989557],
        [40.692498, -73.989591],
        [40.692535, -73.989623],
        [40.692574, -73.989653],
        [40.692615, -73.989682],
        [40.692656, -73.989709],
        [40.692699, -73.989735],
        [40.693219, -73.989998],
        [40.693905, -73.990338],
        [40.693941, -73.990356],
        [40.693977, -73.990373],
        [40.694013, -73.99039],
        [40.69405, -73.990407],
        [40.694087, -73.990423],
        [40.694124, -73.990439],
        [40.694162, -73.990454],
        [40.6942, -73.99047],
        [40.694238, -73.990484],
        [40.694277, -73.990499],
        [40.694316, -73.990513],
        [40.694355, -73.990526],
        [40.694394, -73.99054],
        [40.694434, -73.990552],
        [40.694474, -73.990565],
        [40.69637, -73.991156],
        [40.696442, -73.991177],
        [40.696513, -73.9912],
        [40.696579, -73.991225],
        [40.696643, -73.991255],
        [40.696705, -73.991288],
        [40.696763, -73.991329],
        [40.696818, -73.991374],
        [40.69687, -73.991423],
        [40.696918, -73.991477],
        [40.696964, -73.991536],
        [40.697007, -73.991599],
        [40.697046, -73.991667],
        [40.697083, -73.99174],
        [40.697116, -73.991816],
        [40.697148, -73.991897],
        [40.69718, -73.992018],
        [40.697466, -73.993086],
        [40.700174, -74.00291],
        [40.700423, -74.003652],
        [40.700635, -74.00426],
        [40.700828, -74.00471],
        [40.701068, -74.005185],
        [40.701345, -74.005659],
        [40.701603, -74.006073],
        [40.701924, -74.006508],
        [40.702464, -74.007127],
        [40.704571, -74.009504],
        [40.70477, -74.009737],
        [40.70497, -74.009892],
        [40.705083, -74.009957],
        [40.705177, -74.009987],
        [40.705281, -74.009996],
        [40.70538, -74.009981],
        [40.705567, -74.009938],
        [40.705735, -74.009889],
        [40.705922, -74.009801],
        [40.706141, -74.00967],
        [40.706375, -74.009488],
        [40.706821, -74.0091],
        [40.707382, -74.008592],
        [40.707811, -74.008172],
        [40.709416, -74.006571],
        [40.710148, -74.005869],
        [40.710195, -74.005836],
        [40.710254, -74.005803],
        [40.710315, -74.005777],
        [40.710376, -74.005763],
        [40.710437, -74.005761],
        [40.710496, -74.005772],
        [40.710559, -74.005805],
        [40.71062, -74.005848],
        [40.710726, -74.005949],
        [40.711582, -74.006854],
        [40.711685, -74.006954],
        [40.711788, -74.007035],
        [40.712145, -74.007289],
        [40.712239, -74.007371],
        [40.712337, -74.007453],
        [40.712431, -74.007548],
        [40.712519, -74.007667],
        [40.712596, -74.007813],
        [40.712663, -74.007962],
        [40.713051, -74.008811],
        [40.713598, -74.010029],
        [40.713629, -74.010099],
        [40.713662, -74.01016],
        [40.713699, -74.010213],
        [40.713737, -74.010258],
        [40.713777, -74.010294],
        [40.71382, -74.010321],
        [40.713865, -74.010341],
        [40.713912, -74.010351],
        [40.713961, -74.010353],
        [40.714013, -74.010347],
        [40.714066, -74.010333],
        [40.714122, -74.010309],
        [40.71418, -74.010278],
        [40.714241, -74.010238],
        [40.714303, -74.010188],
        [40.715437, -74.009299],
        [40.715478, -74.009266],
        [40.718032, -74.007249],
        [40.718063, -74.007227],
        [40.718095, -74.007206],
        [40.718127, -74.007186],
        [40.71816, -74.007167],
        [40.718193, -74.00715],
        [40.718228, -74.007133],
        [40.718262, -74.007117],
        [40.718298, -74.007103],
        [40.718334, -74.007089],
        [40.71837, -74.007077],
        [40.718408, -74.007066],
        [40.718446, -74.007055],
        [40.718484, -74.007046],
        [40.718523, -74.007038],
        [40.718563, -74.007031],
        [40.719318, -74.006886],
        [40.722854, -74.006277],
        [40.728251, -74.005367],
        [40.728935, -74.00526],
        [40.729169, -74.005221],
        [40.729283, -74.005197],
        [40.729414, -74.00516],
        [40.729532, -74.005112],
        [40.729642, -74.005062],
        [40.729881, -74.004935],
        [40.730321, -74.004682],
        [40.733422, -74.002906],
        [40.735973, -74.001452],
        [40.736162, -74.001345],
        [40.736358, -74.001229],
        [40.736585, -74.001089],
        [40.736761, -74.000973],
        [40.737826, -74.000201],
        [40.74104, -73.997871],
        [40.744081, -73.995657],
        [40.747215, -73.993365],
        [40.750373, -73.991057],
        [40.75529, -73.987495],
        [40.757342, -73.986009],
        [40.757638, -73.985786],
        [40.757758, -73.985709],
        [40.75788, -73.985638],
        [40.758014, -73.985569],
        [40.758156, -73.985512],
        [40.758375, -73.985421],
        [40.758631, -73.98533],
        [40.759405, -73.985063],
        [40.759714, -73.984959],
        [40.760017, -73.984841],
        [40.760283, -73.984725],
        [40.760592, -73.984577],
        [40.760821, -73.984444],
        [40.76104, -73.984294],
        [40.761728, -73.983849],
        [40.762486, -73.983358],
        [40.76298, -73.983038],
        [40.763412, -73.982793],
        [40.763714, -73.982626],
        [40.764029, -73.982464],
        [40.764386, -73.98232],
        [40.764821, -73.982156],
        [40.765125, -73.982063],
        [40.765461, -73.981977],
        [40.765808, -73.98191],
        [40.766808, -73.981755],
        [40.767172, -73.981702],
        [40.767324, -73.981689],
        [40.76744, -73.981694],
        [40.767561, -73.981697],
        [40.767681, -73.981718],
        [40.767778, -73.981745],
        [40.767895, -73.981781],
        [40.768247, -73.981929],
        [40.768454, -73.982012],
        [40.768582, -73.982053],
        [40.768695, -73.982078],
        [40.768794, -73.982088],
        [40.769222, -73.982098],
        [40.77344, -73.982209],
        [40.774166, -73.982212],
        [40.777496, -73.982091],
        [40.777869, -73.982058],
        [40.778211, -73.982008],
        [40.778453, -73.98197],
        [40.778822, -73.981906],
        [40.779426, -73.981757],
        [40.780996, -73.981314],
        [40.782155, -73.980924],
        [40.782374, -73.980847],
        [40.782622, -73.980748],
        [40.782794, -73.980664],
        [40.78297, -73.980572],
        [40.783149, -73.980473],
        [40.783313, -73.980371],
        [40.783934, -73.979917],
        [40.786953, -73.977656],
        [40.787601, -73.977107],
        [40.788644, -73.976218],
        [40.788957, -73.975942],
        [40.793919, -73.972323],
        [40.794005, -73.972265],
        [40.798506, -73.96898],
        [40.798651, -73.968852],
        [40.798781, -73.96872],
        [40.798896, -73.968582],
        [40.798996, -73.968441],
        [40.79908, -73.968295],
        [40.79915, -73.968144],
        [40.799204, -73.967988],
        [40.799244, -73.967828],
        [40.799268, -73.967664],
        [40.799278, -73.967495],
        [40.799272, -73.967321],
        [40.799251, -73.967143],
        [40.799215, -73.96696],
        [40.799164, -73.966773],
        [40.799099, -73.966582],
        [40.797184, -73.962047],
        [40.797093, -73.961824],
        [40.797002, -73.961593],
        [40.796934, -73.961388],
        [40.79689, -73.961185],
        [40.796872, -73.960984],
        [40.796883, -73.960795],
        [40.796904, -73.960573],
        [40.797535, -73.956739],
        [40.798111, -73.953676],
        [40.798177, -73.95331],
        [40.798251, -73.953008],
        [40.798356, -73.952702],
        [40.798469, -73.95247],
        [40.79856, -73.952322],
        [40.798665, -73.952174],
        [40.798841, -73.952007],
        [40.799075, -73.951822],
        [40.802098, -73.949625],
        [40.807754, -73.945495],
        [40.814229, -73.94077],
        [40.818371, -73.937754],
        [40.818493, -73.93762],
        [40.818607, -73.93748],
        [40.818712, -73.937336],
        [40.818808, -73.937187],
        [40.818896, -73.937034],
        [40.818975, -73.936877],
        [40.819046, -73.936715],
        [40.819108, -73.936548],
        [40.819161, -73.936378],
        [40.819206, -73.936202],
        [40.819242, -73.936023],
        [40.81927, -73.935839],
        [40.819289, -73.935651],
        [40.819299, -73.935458],
        [40.819299, -73.93526],
        [40.819335, -73.931501],
        [40.81933, -73.931334],
        [40.819322, -73.931165],
        [40.819311, -73.930996],
        [40.819298, -73.930827],
        [40.819283, -73.930657],
        [40.819264, -73.930486],
        [40.819243, -73.930316],
        [40.81922, -73.930144],
        [40.819194, -73.929973],
        [40.819165, -73.929801],
        [40.819134, -73.929628],
        [40.8191, -73.929455],
        [40.819064, -73.929282],
        [40.819025, -73.929108],
        [40.818984, -73.928935],
        [40.818685, -73.927782],
        [40.81841, -73.926718],
        [40.816109, -73.917757],
        [40.815782, -73.916675],
        [40.815732, -73.916492],
        [40.815702, -73.916277],
        [40.815684, -73.915934],
        [40.815699, -73.91568],
        [40.81574, -73.915469],
        [40.81582, -73.915203],
        [40.815913, -73.914951],
        [40.815961, -73.914835],
        [40.816005, -73.914728],
        [40.816109, -73.914448],
        [40.816171, -73.914233],
        [40.816201, -73.91403],
        [40.816213, -73.913796],
        [40.816201, -73.913574],
        [40.81618, -73.913328],
        [40.816113, -73.912669],
        [40.816033, -73.911842],
        [40.815974, -73.911136],
        [40.815949, -73.910726],
        [40.815931, -73.910364],
        [40.815931, -73.910082],
        [40.815926, -73.909808],
        [40.815936, -73.909395],
        [40.815963, -73.909111],
        [40.816003, -73.908903],
        [40.816055, -73.908682],
        [40.816174, -73.908375],
        [40.81649, -73.907807],
        [40.817578, -73.905946],
        [40.817813, -73.905518],
        [40.818004, -73.905114],
        [40.8184, -73.90421],
        [40.818818, -73.903268],
        [40.819113, -73.902687],
        [40.819585, -73.90177],
        [40.822181, -73.896736],
        [40.824073, -73.893064],
        [40.824223, -73.892771],
        [40.824431, -73.892368],
        [40.824494, -73.892265],
        [40.824554, -73.892182],
        [40.824649, -73.892091],
        [40.824739, -73.892021],
        [40.824818, -73.891978],
        [40.824901, -73.891946],
        [40.824983, -73.891929],
        [40.825069, -73.891922],
        [40.825522, -73.891924],
        [40.829842, -73.891875],
        [40.829993, -73.891865],
        [40.830113, -73.891849],
        [40.830227, -73.89183],
        [40.830395, -73.891793],
        [40.830667, -73.891704],
        [40.830888, -73.891611],
        [40.831153, -73.891469],
        [40.831358, -73.89134],
        [40.836619, -73.888195],
        [40.83683, -73.888068],
        [40.837034, -73.887939],
        [40.837218, -73.8878],
        [40.837288, -73.887734],
        [40.837371, -73.88765],
        [40.837463, -73.887544],
        [40.837713, -73.887183],
        [40.838935, -73.88512],
        [40.839063, -73.884886],
        [40.839165, -73.884651],
        [40.839252, -73.884441],
        [40.839342, -73.884172],
        [40.839419, -73.883891],
        [40.839484, -73.883573],
        [40.839521, -73.883293],
        [40.839546, -73.88303],
        [40.839567, -73.882597],
        [40.839591, -73.882191],
        [40.839613, -73.881967],
        [40.839642, -73.881759],
        [40.839719, -73.881408],
        [40.839802, -73.881149],
        [40.839913, -73.88085],
        [40.840057, -73.880498],
        [40.840155, -73.880284],
        [40.840229, -73.880147],
        [40.840295, -73.880049],
        [40.840415, -73.879899],
        [40.840583, -73.879734],
        [40.841051, -73.879283],
        [40.841151, -73.879175],
        [40.841205, -73.879076],
        [40.841245, -73.878966],
        [40.841273, -73.878829],
        [40.841277, -73.878707],
        [40.841267, -73.878599],
        [40.841249, -73.878512],
        [40.841212, -73.878423],
        [40.84113, -73.878219],
        [40.841049, -73.878027],
        [40.840945, -73.877782],
        [40.840895, -73.877644],
        [40.840846, -73.877474],
        [40.840817, -73.87733],
        [40.840795, -73.877172],
        [40.840786, -73.87701],
        [40.840784, -73.876841],
        [40.840801, -73.876624],
        [40.840847, -73.876313],
        [40.841121, -73.874736],
        [40.84117, -73.874543],
        [40.84121, -73.87443],
        [40.841252, -73.874329],
        [40.841324, -73.874215],
        [40.841402, -73.874109],
        [40.841894, -73.873488],
        [40.84325, -73.87179],
        [40.843567, -73.871389],
        [40.84391, -73.871028],
        [40.844101, -73.870857],
        [40.844293, -73.870717],
        [40.844505, -73.870597],
        [40.844767, -73.870472],
        [40.845525, -73.870143],
        [40.845968, -73.869952],
        [40.846768, -73.869609],
        [40.847153, -73.869431],
        [40.847565, -73.869194],
        [40.848828, -73.868457],
        [40.849338, -73.868153],
        [40.849629, -73.867986],
        [40.849772, -73.867921],
        [40.849929, -73.867873],
        [40.85007, -73.867846],
        [40.850249, -73.867834],
        [40.857192, -73.867615],
        [40.865462, -73.867352],
        [40.871356, -73.867164],
        [40.875827, -73.867025],
        [40.87619, -73.867016],
        [40.876367, -73.866997],
        [40.876523, -73.86697],
        [40.876693, -73.866928],
        [40.876861, -73.866859],
        [40.876988, -73.866787],
        [40.87785, -73.866256],
        [40.881715, -73.863846],
        [40.883895, -73.862633],
        [40.888022, -73.860341],
        [40.893193, -73.857473],
        [40.897451, -73.855124],
        [40.897716, -73.85494],
        [40.8979, -73.854784],
        [40.898379, -73.854376],
        [40.899595, -73.853333],
        [40.899929, -73.853045],
        [40.90026, -73.852766],
        [40.900653, -73.852447],
        [40.900798, -73.85234],
        [40.901261, -73.852026],
        [40.901669, -73.851769],
        [40.901895, -73.851628],
        [40.902066, -73.85151],
        [40.902261, -73.85136],
        [40.903125, -73.85062]
    ];

    var latlons = [];
    for (var i = 0; i < weird_test.length; i++) {
        latlons.push(L.latLng(weird_test[i][0], weird_test[i][1]));
    }
    var weird_test_line = L.polyline(latlons, {
        weight: 3,
        color: '#ff0000'
    });

    var latlons = [];
    for (var i = 0; i < weird_test2.length; i++) {
        latlons.push(L.latLng(weird_test2[i][0], weird_test2[i][1]));
    }
    var weird_test2_line = L.polyline(latlons, {
        weight: 3,
        color: '#00ff00'
    });

    console.log(self.map);
    self.map.addLayer(weird_test2_line);
    self.map.addLayer(weird_test_line);
};

window.initbus = function() {
    bus.init();

};
